<% if Rails.configuration.wowza_enabled
  solr_document = file_set
  solr_document = file_set.solr_document if (file_set.respond_to? :solr_document)

  parent_id = parent.id if defined?(parent) && !parent.nil?
  fedora_file = solr_document['service_file_digest_ssim'].first.split(':')[-1] if !solr_document['service_file_digest_ssim'].nil?

  file_ext = 'mp4'
  file_ext = solr_document['label_tesim'].first.split('.')[-1] if solr_document['label_tesim'].first

  wowzaURL = wowza_url(parent_id, file_set.id, fedora_file, file_ext, request.ip)
%>
  <% if wowzaURL != nil %>
    <video controls="controls" id="dams-video">Loading the player...</video>

    <script type="text/javascript">
      jwplayer("dams-video").setup({
        playlist:
          [{
            sources:
              [
                {file: "http://<%=wowzaURL%>/manifest.mpd"},
                {file: "http://<%=wowzaURL%>/playlist.m3u8"},
                {file: "rtmp://<%=wowzaURL%>"}
              ]
          }],
        width: "100%",
        aspectratio: "16:9",
        rtmp: {bufferlength: 3},
        analytics: {enabled: false},
        fallback: false
      });
    </script>
  <% end %>
<% else %>
  <video controls="controls" class="video-js vjs-default-skin" data-setup="{}" preload="auto">
    <source src="<%= main_app.download_path(file_set, file: 'service_file') %>" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
<% end %>

