# Generated by hyrax:models:install
class FileSet < ActiveFedora::Base
  include ::Hyrax::FileSetBehavior

  property :rights_override, predicate: VisibilityService::PREDICATE_RIGHTS_OVERRIDE, multiple: false do |index|
    index.as :stored_searchable
  end

  def visibility
    return VisibilityService.visibility_value(rights_override) if rights_override.present?
    super
  end

  def visibility=(value)
    case value
    when VisibilityService::VISIBILITY_TEXT_VALUE_SUPPRESS_DISCOVERY,
           VisibilityService::VISIBILITY_TEXT_VALUE_CULTURALLY_SENSITIVE
      self.rights_override = VisibilityService.rights_override_value(value)
      value = Hydra::AccessControls::AccessRight::VISIBILITY_TEXT_VALUE_PUBLIC
    when VisibilityService::VISIBILITY_TEXT_VALUE_METADATA_ONLY
      self.rights_override = VisibilityService.rights_override_value(value)
      value = Hydra::AccessControls::AccessRight::VISIBILITY_TEXT_VALUE_PRIVATE
    else
      self.rights_override = nil
    end
    super
  end
end
